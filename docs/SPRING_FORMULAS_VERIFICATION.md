# 弹簧工程分析公式验证

> 验证日期：2025-12-07
> 状态：✅ 已验证（经 OpenAI 专家审查）
> 修订：2025-12-07 - 修正扭簧刚度公式常数 (64 → 10.8)

本文档记录了四种弹簧类型的工程分析计算公式，确保每种弹簧使用正确的公式。

---

## 1. 压缩弹簧 (Compression Spring)

### 刚度公式
```
k = (G × d⁴) / (8 × Dm³ × Na)
```
- **G**: 剪切模量 (MPa)
- **d**: 线径 (mm)
- **Dm**: 中径 (mm)
- **Na**: 有效圈数

### 应力公式
```
τ = Kw × (8 × F × Dm) / (π × d³)
```
- **Kw**: Wahl 修正系数 = (4C - 1)/(4C - 4) + 0.615/C
- **C**: 旋绕比 = Dm/d
- **F**: 载荷 (N)

### 力-位移关系
```
F = k × Δx
```

### 工程限制条件（补充）

#### 固高 (Solid Height)
```
Ls = Nt × d
```
- **Nt**: 总圈数 = Na + 支承圈数

#### 最大允许位移
```
Δx_max ≈ (L0 - Ls) × 0.85
```
保留 10-15% 安全间隙，防止硬碰。

**文件位置**: 
- `src/lib/engine/forceCurve.ts` → `calculateCompressionSpringRate()`
- `src/lib/engine/stress.ts` → `calculateNominalShearStress()`

---

## 2. 拉伸弹簧 (Extension Spring)

### 刚度公式
```
k = (G × d⁴) / (8 × Dm³ × Na)
```
与压缩弹簧相同

### 应力公式
```
τ = Kw × (8 × F_total × Dm) / (π × d³)
```
- **F_total**: 总载荷 = F₀ + k × Δx
- **F₀**: 初拉力 (N)

### 力-位移关系
```
F = F₀ + k × Δx
```
**注意**: 拉簧有初拉力 F₀，这是与压簧的主要区别！

### 钩部应力（补充）

拉簧往往是钩先坏，钩部应力通常高于弹簧体：
```
σ_hook ≈ Kb × (32 × F_total × Dh) / (π × d³)
```
- **Dh**: 钩弯曲处的等效直径（一般略小于 Dm）
- **Kb**: 弯曲修正系数（1.0–1.3，随 C 变化）

**文件位置**: 
- `src/lib/engine/forceCurve.ts` → `calculateExtensionSpringRate()`, `generateExtensionForceCurve()`
- `src/lib/engine/hookStress.ts` → 钩部应力计算

---

## 3. 扭转弹簧 (Torsion Spring)

### 刚度公式 ⚠️ 已修正

**标准公式（弧度制）**:
```
k_rad = (E × d⁴) / (10.8 × Dm × Na)  [N·mm/rad]
```

**转换为度制**:
```
k_deg = k_rad × (π/180)  [N·mm/deg]
```

- **E**: 弹性模量 (MPa)，不是剪切模量！
- **10.8**: 标准常数（来源: SMI Handbook, DIN EN 13906-3）
- 扭簧使用弹性模量 E，不是剪切模量 G
- ⚠️ 注意：旧版本使用 64 是错误的，会导致刚度计算偏小

### 应力公式（弯曲应力，不是剪切应力！）
```
σ = Ki × (32 × M) / (π × d³)
```
- **Ki**: 曲率修正系数 = (4C² - C - 1) / (4C × (C - 1))
- **M**: 扭矩 (N·mm)
- **σ**: 弯曲应力 (MPa)

### 扭矩-角度关系
```
M = k_deg × θ
```
- **θ**: 角度 (度)

### 自由角/工作角关系（补充）
```
M = k_rad × (θ_work - θ_free)
```
内部计算统一用 rad，界面显示用 deg。

**关键区别**:
1. 使用弹性模量 E，不是剪切模量 G
2. 计算弯曲应力 σ，不是剪切应力 τ
3. 单位是扭矩 (N·mm) 和角度 (°)，不是力 (N) 和位移 (mm)

**文件位置**: 
- `src/lib/engine/forceCurve.ts` → `calculateTorsionSpringRate()`, `generateTorsionForceCurve()`
- `src/lib/engine/stress.ts` → `calculateBendingStress()`
- `src/lib/engine/torsionAdvancedAnalysis.ts` → 扭簧高级分析

---

## 4. 锥形弹簧 (Conical Spring)

### 初始刚度公式
```
k = (G × d⁴) / (2 × Na × (D1 + D2) × (D1² + D2²))
```
- **D1**: 大端中径 (mm)
- **D2**: 小端中径 (mm)

**假设条件**:
- 线性变化的中径
- 恒定线径
- 所有圈均未贴合
- 螺距小角度近似
- 此公式用于计算**初始刚度**

### 非线性特性
锥形弹簧在压缩过程中，线圈逐渐贴底，刚度逐渐增加：
```
k_current = (G × d⁴) / (2 × Na_remaining × (D1_eff + D2_eff) × (D1_eff² + D2_eff²))
```
- **Na_remaining**: 剩余有效圈数
- **D1_eff**: 有效大端中径

### 应力公式（在大端最大）
```
τ_max = Kw × (8 × F × D1) / (π × d³)
```
应力在大端（D1）最大，因为力矩臂最长

### 工程限制条件（补充）

#### 可套叠（Telescoping）条件
```
D1 - D2 ≥ (Nt + 1) × d
```
保证每圈压实后可以"套进去"而不干涉。

#### 固高（完全套叠时）
```
Ls ≈ (N_dead + 1) × d
```
对于完全套叠的锥簧，固高不再是 Nt × d。

**关键区别**:
1. 非线性力-位移曲线
2. 刚度随压缩量增加（渐进硬化）
3. 最大应力在大端
4. 可完全套叠（固高更小）

**文件位置**: 
- `src/lib/engine/forceCurve.ts` → `calculateConicalSpringRate()`, `generateConicalForceCurve()`
- `src/lib/engine/stress.ts` → `calculateConicalMaxStress()`

---

## 公式对比表

| 参数 | 压缩弹簧 | 拉伸弹簧 | 扭转弹簧 | 锥形弹簧 |
|------|----------|----------|----------|----------|
| **模量** | G (剪切) | G (剪切) | E (弹性) | G (剪切) |
| **应力类型** | 剪切 τ | 剪切 τ | 弯曲 σ | 剪切 τ |
| **修正系数** | Wahl Kw | Wahl Kw | 曲率 Ki | Wahl Kw |
| **初始力** | 0 | F₀ (初拉力) | 0 | 0 |
| **线性/非线性** | 线性 | 线性 | 线性 | 非线性 |
| **输入单位** | mm | mm | 度 (°) | mm |
| **输出单位** | N | N | N·mm | N |

---

## 代码验证清单

### ✅ 已验证
- [x] 压缩弹簧刚度公式正确
- [x] 拉伸弹簧刚度公式正确，包含初拉力
- [x] 扭转弹簧使用弹性模量 E
- [x] 扭转弹簧计算弯曲应力
- [x] 锥形弹簧非线性刚度计算
- [x] 锥形弹簧最大应力在大端
- [x] Wahl 修正系数公式正确
- [x] 曲率修正系数 Ki 公式正确

### 显示验证
- [x] 应力热点：扭簧显示角度 θ，其他显示圈数
- [x] 力-位移曲线：扭簧显示扭矩-角度，其他显示力-位移

---

## 5. 高级分析公式

### 5.1 疲劳分析 (Fatigue Analysis)

#### Basquin 方程
```
S = A × N^(-b)
N = (A / S)^(1/b)
```
- **S**: 应力幅值 (MPa)
- **N**: 循环次数
- **A, b**: 材料常数（从 S-N 曲线拟合）

#### Goodman 平均应力修正
```
σ_a_eff = σ_a / (1 - σ_m / σ_uts)
```
- **σ_a**: 应力幅值
- **σ_m**: 平均应力
- **σ_uts**: 极限抗拉强度

**说明**: 此公式为"等效应力"写法，默认在与材料耐久极限 S_e 比较时使用。
若显式使用 Goodman 直线，应写为：
```
σ_a/S_e + σ_m/σ_uts = 1
```

**文件位置**: `src/lib/engine/fatigue.ts`

---

### 5.2 屈曲分析 (Buckling Analysis)

#### 细长比
```
λ = L0 / Dm
```

#### 临界屈曲载荷（欧拉公式）
```
P_cr = π² × E × I / L_eff²
```
- **I**: 惯性矩 = π × d⁴ / 64
- **L_eff**: 有效长度 = Ke × L0
- **Ke**: 端部条件系数
  - 两端固定: 0.5
  - 一端固定一端自由: 2.0
  - 两端铰接: 1.0

#### 曲率修正系数（经验公式）
```
Kc = 1 - 0.1/C
```
- **类型**: 经验修正系数（近似值）
- **来源**: 参考 Wahl 经验公式
- **适用范围**: 常见 C 范围（4 ≤ C ≤ 12）
- **注意**: 各家手册对弹簧屈曲的修正因子写法不完全一样，一般给图表/曲线

**文件位置**: `src/lib/engine/buckling.ts`

---

### 5.3 动力学分析 (Dynamics Analysis)

#### 线材长度
**简化公式**（节距较小时）:
```
L_wire = π × Dm × N_total
```

**精确公式**（考虑节距）:
```
L_wire ≈ N_total × √[(π × Dm)² + p²]
```
- **p**: 节距
- 当 p ≪ π×Dm 时退化为简化公式

#### 弹簧质量
```
m = ρ × (π × d²/4) × L_wire
```

#### 固有频率（轴向振动）
```
fn = (1/2π) × √(k / m_eff)
```

**有效质量**:
- 单独弹簧（一端固定、另一端自由振动的一阶模态）:
  ```
  m_eff ≈ m/3
  ```
- 弹簧 + 外部负载:
  ```
  m_eff ≈ m_load + η × m，其中 η ≈ 1/3
  ```

#### 冲击波速度（剪切波）
```
v = √(G / ρ)
```
- **v**: 剪切波传播速度（弹簧线材内部的应力波）
- 注: 纵波速度为 √(E/ρ)

#### 共振检测
- 工作频率在固有频率 ±15% 范围内视为共振风险
- 检查前 5 次谐波

**文件位置**: `src/lib/engine/dynamics.ts`

---

### 5.4 扭簧高级分析 (Torsion Spring Advanced)

#### 质量计算（含腿）
```
L_coil = π × Dm × Na
L_total = L_coil + L_leg1 + L_leg2
m = ρ × (π × d²/4) × L_total
```
注: 可按需改用精确公式 `L_coil ≈ Na × √[(π×Dm)² + p²]`

#### 扭簧固有频率 ⚠️ 已修正
```
fn = (1/2π) × √(k_θ / J)
k_θ = E × d⁴ / (10.8 × Dm × Na)  [N·mm/rad]
```
- **k_θ**: 扭转刚度，单位必须是 N·mm/rad
- ⚠️ 注意：旧版本使用 `× (180/π)` 是错误的，已删除

#### 转动惯量（一阶近似）
```
J = (1/3) × m_leg × L_leg²
```
- 这是细长杆绕端点转动的转动惯量公式
- **适用条件**: 腿主导惯量的情况
- **限制**: 未包含线圈部分惯量，为一阶近似

#### 弯曲应力修正系数
```
Ki = (4C² - C - 1) / (4C × (C - 1))
σ = Ki × (32 × M) / (π × d³)
```

**文件位置**: `src/lib/engine/torsionAdvancedAnalysis.ts`

---

### 5.5 温度效应 (Temperature Effects)

#### 模量温度修正
```
G(T) = G_20 × [1 - α × (T - 20)]
```
- **α**: 温度系数（约 0.0003/°C）
- **适用范围**: 中低温工作区间（常温 ~ 200°C）
- **注意**: 高温需使用材料厂商给出的 G(T) 曲线

**文件位置**: `src/lib/engine/temperature.ts`

---

### 5.6 蠕变分析 (Creep Analysis)

#### 蠕变应变（Time-Hardening 型）
```
ε_creep = A × σ^n × t^m × exp(-Q/RT)
```
- **A, n, m**: 材料常数（需从对应材料的高温试验拟合得到）
- **Q**: 激活能
- **R**: 气体常数
- **T**: 绝对温度 (K)

**注意**: 此公式为 Norton + Time Hardening 的组合形式，参数必须来自实验数据。

**文件位置**: `src/lib/engine/creep.ts`

---

## 高级分析公式验证清单

### ✅ 已验证
- [x] Basquin 疲劳方程正确
- [x] Goodman 平均应力修正正确
- [x] 欧拉屈曲公式正确
- [x] 端部条件系数正确
- [x] 固有频率公式正确
- [x] 有效质量系数 1/3 正确
- [x] 扭簧使用弹性模量 E（不是 G）
- [x] 扭簧弯曲应力修正系数 Ki 正确
- [x] 冲击波速度公式正确

---

## 参考标准

- **DIN EN 13906-1**: 圆柱螺旋压缩弹簧
- **DIN EN 13906-2**: 圆柱螺旋拉伸弹簧
- **DIN EN 13906-3**: 圆柱螺旋扭转弹簧
- **SMI Handbook of Spring Design**: 弹簧设计手册
- **Shigley's Mechanical Engineering Design**: 疲劳分析
- **Roark's Formulas for Stress and Strain**: 屈曲分析
